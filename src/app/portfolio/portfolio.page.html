<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Portfolio
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Portfolio</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- Donut Chart -->
  <div style="display: flex; justify-content: center; align-items: center; margin: 24px 0;">
    <svg width="140" height="140" viewBox="0 0 140 140">
      <g *ngIf="investmentsWithPercent$ | async as investments">
        <ng-container *ngFor="let inv of investments; let i = index; let last = last">
          <circle
            [attr.r]="60"
            [attr.cx]="70"
            [attr.cy]="70"
            fill="none"
            [attr.stroke]="donutColors[i % donutColors.length]"
            [attr.stroke-width]="10"
            [attr.stroke-dasharray]="getDonutDash(inv.percent, 60)"
            [attr.stroke-dashoffset]="getDonutOffset(i, investments, 60)"
            stroke-linecap="round"
          />
        </ng-container>
        <!-- Center text -->
        <text x="70" y="70" text-anchor="middle" dominant-baseline="middle" font-size="20" fill="#fff" font-weight="bold">
          ${{ getTotalValue(investments) | number:'1.0-0' }}
        </text>
      </g>
    </svg>
  </div>

  <!-- List Header -->
  <div style="margin: 0 20px 8px 20px; padding-left: 12px; display: flex; justify-content: space-between; align-items: center; color: #aaa; font-size: 0.95em; font-weight: 600; letter-spacing: 0.02em;">
    <div style="flex: 1;">Asset</div>
    <div style="flex: 1; text-align: right;">Price</div>
    <div style="flex: 1; text-align: right;">Investment</div>
  </div>

  <div *ngIf="investmentsWithPercent$ | async as investments">
    <div *ngFor="let inv of investments; let i = index; trackBy: trackBySymbol" style="padding: 12px 12px 0 12px; position: relative; margin-bottom: 8px; margin-left: 20px; margin-right: 20px;">
      <div style="position: absolute; left: 0; top: 12px; width: 4px; height: 30px; border-radius: 2px;" [style.background]="donutColors[i % donutColors.length]"></div>
      <div style="display: flex; width: 100%; justify-content: space-between; align-items: center; padding-left: 12px;">
        <!-- First column: Name and Symbol -->
        <div style="flex: 1; display: flex; flex-direction: column; gap: 12px;">
          <span style="font-weight: bold;">{{ inv.name }}</span>
          <span style="color: #888; margin-bottom: 12px;">{{ inv.symbol }} <span style="color: #fff; font-weight: 500;">({{ inv.quantity }})</span></span>
        </div>
        <!-- Second column: Price and % Change -->
        <div style="flex: 1; display: flex; flex-direction: column; align-items: flex-end; gap: 12px;">
          <span>
            <span [style.color]="getPriceColor(inv.symbol)">
              {{ getPriceTick(inv.symbol)?.price | number:'1.2-2' }}
            </span>
          </span>
          <span [style.color]="inv.percentDiff > 0 ? 'green' : (inv.percentDiff < 0 ? 'red' : '')" style="margin-bottom: 12px;">
            {{ inv.percentDiff | number:'1.1-2' }}%
          </span>
        </div>
        <!-- Third column: Total Value and % of Portfolio -->
        <div style="flex: 1; display: flex; flex-direction: column; align-items: flex-end; gap: 12px;">
          <span style="font-weight: bold;">{{ inv.totalValue | number:'1.2-2' }}</span>
          <span style="color: #888; margin-bottom: 12px;">{{ inv.percent | number:'1.1-1' }}%</span>
        </div>
      </div>
    </div>
  </div>
</ion-content>
