<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/market"></ion-back-button>
    </ion-buttons>
    <ion-title>Product Detail</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Line Graph -->
  <div *ngIf="priceTick" style="max-width: 420px; margin: 32px auto 0 auto; padding: 0 20px 16px 20px;">
    <svg width="100%" height="80" viewBox="0 0 140 80">
      <polyline
        *ngIf="priceTick.history.length > 1"
        [attr.points]="getLineGraphPoints(priceTick.history, 140, 80)"
        fill="none"
        stroke="#4F8EF7"
        stroke-width="2"
      />
      <!-- Optionally, show the current price as a dot -->
      <circle
        *ngIf="priceTick.history.length > 0"
        [attr.cx]="getCurrentX(priceTick.history, 140)"
        [attr.cy]="getCurrentY(priceTick.history, 80)"
        r="3"
        fill="#FFD60A"
        stroke="#232323"
        stroke-width="1"
      />
    </svg>
  </div>

  <div style="max-width: 420px; margin: 32px auto; padding: 24px 20px; background: #232323; border-radius: 18px; box-shadow: 0 2px 16px 0 rgba(0,0,0,0.08); display: flex; flex-direction: column; gap: 20px;">
    <div *ngIf="loading" style="text-align: center; padding: 32px 0;">Loading...</div>
    <div *ngIf="!loading && product" style="display: flex; flex-direction: column; gap: 18px;">
      <div style="display: flex; flex-direction: column; gap: 4px;">
        <h2 style="margin: 0; font-size: 1.4em; font-weight: 700;">{{ product.name }}</h2>
        <span style="color: #888; font-size: 1em;">{{ product.symbol }}</span>
        <span *ngIf="product.description" style="color: #bbb; font-size: 1em; margin-top: 4px;">{{ product.description }}</span>
      </div>
      <div style="display: flex; align-items: center; gap: 12px;">
        <span style="font-size: 1.2em; font-weight: 600;">Price:</span>
        <span [style.color]="getPriceColor()" style="font-size: 1.2em; font-weight: 600;">
          {{ priceTick?.price | number:'1.2-2' }}
        </span>
      </div>
      <form (ngSubmit)="buy()" style="display: flex; flex-direction: column; gap: 16px;">
        <ion-item style="--background: transparent; --border-radius: 12px;">
          <ion-label position="floating">Quantity</ion-label>
          <ion-input type="number" [(ngModel)]="quantity" name="quantity" min="1" (ngModelChange)="onQuantityChange($event)"></ion-input>
        </ion-item>
        <div style="margin-top: 1em; font-size: 1.1em;">
          <strong>Total:</strong>
          {{ (priceTick?.price || price || 0) * validQuantity | number:'1.2-2' }}
        </div>
        <ion-button expand="block" type="submit" [disabled]="!validQuantity">Buy</ion-button>
      </form>
    </div>
  </div>
</ion-content>
